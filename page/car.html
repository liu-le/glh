<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车</title>
    <link rel="stylesheet" href="../css/public.css">

    <link rel="stylesheet" href="../css/car.css">

</head>

<body>
    <div id="top">
        <div class="margin clear">
            <div class="left">
                <ul>
                    <li><a href="http://localhost:81/guolehui/index.html"><img src="../images/t3.gif" alt="">&nbsp返回首页</a></li>
                    <li><a href="##"><img src="../images/t5.gif" alt="">&nbsp收藏本站</a></li>
                    <li>送货至</li>
                    <li>
                        <select name="" id="">
                            <option>北京</option>
                            <option>上海</option>
                            <option>深圳</option>
                            <option>广州</option>
                            <option>杭州</option>
                        </select>
                    </li>
                </ul>
            </div>
            <div class="right">
                <ul>
                    <li>hi，欢迎来到果乐汇！</li>
                    <li><a href="##" class="button">登录</a></li>
                    <i>|</i>
                    <li><a href="##" class="zc">注册</a></li>
                    <i>|</i>
                    <li><a href="##">全国宅配</a></li>
                    <i>|</i>
                    <li><a href="##">品牌介绍</a></li>
                    <i>|</i>
                    <li class="wei">
                        关注微信
                        <img src="../images/t6.jpg" alt="" width="150" height="150" class="t">
                    </li>
                    <li class="hui">会员中心
                        <div>
                            <p>我的订单</p>
                            <p>我的收藏</p>
                            <p>我的积分</p>
                        </div>
                    </li>
                    <li><i><img src="../images/t2.gif" alt=""></i></li>
                </ul>
            </div>
        </div>
    </div>
    <header id="head">
        <div class="hl margin">
            <div class="lt"><img src="../images/t7.jpg"></div>

            <div class="middle clear">
                <div class="inpt">
                    <input type="text" id="search" placeholder="热门商品搜索">
                    <button type="submit" class="btn">搜索</button>
                    <ul class="search-res" id="list">

                    </ul>
                </div>

                <div class="key">
                    <a href="" target="_blank">海鲜大礼包</a>
                    <a href="" target="_blank">新西兰水果</a>
                    <a href="" target="_blank">水果礼盒</a>
                    <a href="" target="_blank">商务卡券</a>
                </div>
            </div>
            <div class="rt">
                <span class="buton"><i><img src="../images/t6.gif" alt=""></i><a>我的购物车&nbsp;></a></span>
            </div>
        </div>

    </header>
    <nav>
        <div class="margin clear">
            <div class="pp">
                <p><i></i><a href="#">全部商品分类</a></p>

                <i class="ibox"><a href="">
                        <h3>进口水果</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>
                <i class="ibox"><a href="">
                        <h3>国产水果</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>
                <i class="ibox"><a href="">
                        <h3>高档水果礼盒</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>
                <i class="ibox"><a href="">
                        <h3>端午节屯狗专区</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>
                <i class="ibox"><a href="">
                        <h3>商务型提货券</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>
                <i class="ibox"><a href="">
                        <h3>666通用型提货券</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>
                <i class="ibox"><a href="">
                        <h3>水果礼品卡</h3><span>南非水果&nbsp泰国水果&nbsp越南水果</span>
                    </a>
                    <ul class="al">

                    </ul>
                </i>


            </div>
            <a href="##">首页</a>
            <a href="##">会员中心</a>
            <a href="##">品牌发展</a>
            <a href="##">企业采购<i class="nn"></i></a>
            <a href="##">企业采购<i class="hh"></i></a>
            <a href="##">水果礼盒</a>
            <a href="../page/xiangqing.html">团购中心</a>

        </div>

    </nav>
    <main>

        <table border="2" cellspacing="0" width="1200" align="center" class="tab">
            <thead>
                <tr>
                    <th>选中</th>
                    <th>图片</th>
                    <th>名字</th>
                    <th>价格</th>
                    <th>数量</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </main>

    <div id="btt">
        <div class="margin">
            <div class="_result">
                <button class="press"><a>清空购物车</a></button>
                <button class="shop"><a href="">商品凑单</a></button>
            </div>
            <div class="result_">
                <span><a href="##">继续购物</a></span>
                <button class="down"><a>下单结算 >></a></button>
            </div>
        </div>
    </div>

    <div id="footerbg">
        <div class="margin footer">

            <div class="AdvBanner" id="ad_pic_1111"><img
                    src="http://mall.guolehui.com.cn/public/images/60/f6/c3/e633fe6678cc821d125529f351d730382d9ae207.jpg?1506007963#w"
                    alt=""></div>
            <div class="clear" style="border-bottom:1px solid #e7e7e7;"> </div>
            <div class="clear h20"> </div>
            <div class="foota">
                <div class="tangArticle ">
                    <div class="tangTitle clearfix">
                        <h3><a href="http://www.guolehui.com.cn/article-xinshouzhinan-l-24.html"><span>新手指南</span></a>
                        </h3>
                    </div>


                    <ul class="news-list tangContent clearfix">
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-xinshouzhinan-61.html" title="订购方式">订购方式</a>
                        </li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-xinshouzhinan-62.html" title="顾客须知">顾客须知</a>
                        </li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-xinshouzhinan-63.html" title="会员积分">会员积分</a>
                        </li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-xinshouzhinan-65.html" title="预存款支付">预存款支付</a>
                        </li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-xinshouzhinan-69.html" title="用户注册">用户注册</a>
                        </li>
                    </ul>


                </div>
            </div>
            <div class="foota">
                <div class="tangArticle ">
                    <div class="tangTitle clearfix">
                        <h3><a href="http://www.guolehui.com.cn/article-gouwuzhinan-l-23.html"><span>购物指南</span></a>
                        </h3>
                    </div>


                    <ul class="news-list tangContent clearfix">
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwuzhinan-64.html" title="联系客服">联系客服</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwuzhinan-66.html" title="发票说明">发票说明</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwuzhinan-67.html" title="用户常见问题">用户常见问题</a>
                        </li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwuzhinan-68.html" title="购物流程">购物流程</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwuzhinan-91.html" title="手机订购">手机订购</a></li>
                    </ul>


                </div>
            </div>
            <div class="foota">
                <div class="tangArticle ">
                    <div class="tangTitle clearfix">
                        <h3><a
                                href="http://www.guolehui.com.cn/article-zhifupeisongfangshi-l-21.html"><span>支付配送方式</span></a>
                        </h3>
                    </div>


                    <ul class="news-list tangContent clearfix">
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-zhifupeisongfangshi-37.html"
                                title="礼品卡/账户余额">礼品卡/账户余额</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-zhifupeisongfangshi-38.html"
                                title="支付方式">支付方式</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-zhifupeisongfangshi-39.html"
                                title="订单出库时间">订单出库时间</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-zhifupeisongfangshi-71.html"
                                title="全国标准配送范围">全国标准配送范围</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-zhifupeisongfangshi-72.html"
                                title="货到付款">货到付款</a></li>
                    </ul>


                </div>
            </div>
            <div class="foota">
                <div class="tangArticle ">
                    <div class="tangTitle clearfix">
                        <h3><a href="http://www.guolehui.com.cn/article-gouwutiaokuan-l-22.html"><span>购物条款</span></a>
                        </h3>
                    </div>


                    <ul class="news-list tangContent clearfix">
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwutiaokuan-35.html"
                                title="隐私保护政策">隐私保护政策</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwutiaokuan-36.html"
                                title="会员注册协议">会员注册协议</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwutiaokuan-73.html"
                                title="商品退换货政策">商品退换货政策</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwutiaokuan-78.html"
                                title="提货券兑换售后">提货券兑换售后</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-gouwutiaokuan-79.html"
                                title="48小时退换货">48小时退换货</a></li>
                    </ul>


                </div>
            </div>
            <div class="foota">
                <div class="tangArticle ">
                    <div class="tangTitle clearfix">
                        <h3>公司简介</h3>
                    </div>


                    <ul class="news-list tangContent clearfix">
                        <li class="article-index lv-1 item"><a href="http://www.guolehui.com.cn/article-cominfo-75.html"
                                title=" 招聘信息"> 招聘信息</a></li>
                        <li class="article-index lv-1 item"><a href="http://www.guolehui.com.cn/article-cominfo-76.html"
                                title="联系我们">联系我们</a></li>
                        <li class="article-index lv-1 item"><a href="http://www.guolehui.com.cn/article-cominfo-77.html"
                                title="业务合作">业务合作</a></li>
                        <li class="article-index lv-1 item"><a
                                href="http://www.guolehui.com.cn/article-cominfo-138.html" title="关于我们">关于我们</a></li>
                    </ul>


                </div>
            </div>
            <div class="foota">
                <div class="userdefine">
                    <a href=""> &gt; 关注公众微信</a>
                </div>

                <div class="AdvBanner" id="ad_pic_1157"><img
                        src="http://mall.guolehui.com.cn/public/images/47/f6/77/baf99c638464f57ace0671bd3cbbd2ef5f3c8176.jpg?1542717815#h"
                        alt=""></div>
            </div>
            <div class="foota">
                <div class="AdvBanner" id="ad_pic_1108"><img
                        src="http://mall.guolehui.com.cn/public/images/0c/7e/5f/2f63caa520445be74cf1573354d97d7306684579.jpg?1506005775#w"
                        alt="果乐汇客服"></div>
            </div>
            <div class="clear h15"> </div>

        </div>

    </div>
    <div class="foorbg">
        <div style="height:100px; overflow:hidden; text-align:center;" class="footdb">
            <p>
                <font face="Microsoft Yahei">
                    <font size="2">
                        <font color="#000000"></font>果乐汇GUOLEHUI.COM.CN 上海汤圣电子商务有限公司
                    </font>版权所有<span style="line-height: 19px; font-stretch: normal;">&nbsp;</span><span
                        style="text-align: center; line-height: 18px;">|&nbsp; </span>All Rights
                    Reserved©2011-2019&nbsp;<span style="text-align: center; line-height: 18px;">| 公司</span>统一信用码<span
                        style="line-height: 19px;">&nbsp;</span>913101165852570112
                </font>
                </font>
            </p>
            <font face="Microsoft Yahei">
                <font size="2">
                    <font color="#000000">
                    </font>
                </font>
            </font>
            <p>
                <font face="Microsoft Yahei">
                    <font size="2">&nbsp;<span
                            style="line-height: 19px; font-stretch: normal;"><strong>许可证:&nbsp;</strong></span><span
                            style="line-height: 19px; font-stretch: normal;"><a
                                href="http://www.miitbeian.gov.cn/state/outPortal/loginPortal.action" target="_blank"
                                type="url">沪ICP备12027781号</a>-2</span>&nbsp;<span
                            style="text-align: center; line-height: 18px;">|&nbsp;</span></font>
                </font><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011002000127" type="url">
                    <img
                        src="http://mall.guolehui.com.cn/public/images/f1/61/80/c589fe3c85532db64cf979962fb00e80705fade9.png?1551340128#h"></a>&nbsp;&nbsp;<span
                    style="font-size: small; font-family: &quot;Microsoft Yahei&quot;; color: rgb(51, 51, 51);">沪公网安备</span><span
                    style="font-size: small; font-family: &quot;Microsoft Yahei&quot;; line-height: 19px; font-stretch: normal;">&nbsp;<span
                        style="color: rgb(51, 51, 51);">31011002000127</span></span><span
                    style="font-size: small; color: rgb(51, 51, 51); font-family: arial;"> 号</span>
            </p>
            <p>
                <img
                    src="http://mall.guolehui.com.cn/public/images/04/4c/fc/ca040708e028cc2ca1093f8def1bd22a08c8ea2c.gif?1412564297#w">&nbsp;<a
                    href="http://www.sgs.gov.cn/lz/licenseLink.do?method=licenceView&amp;entyId=20130909171114957"
                    target="_blank" type="url">&nbsp;&nbsp;</a><a href="" type="url">&nbsp;</a><a
                    href="http://www.shjbzx.cn/" type="url">&nbsp;</a><a href="http://www.shjbzx.cn/" target="_blank"
                    type="url">
                    <img
                        src="http://mall.guolehui.com.cn/public/images/03/92/d4/cc24c37a34999f596babad958547289cc43c2273.jpg?1516273807#w">&nbsp;</a>&nbsp;<a
                    href="http://www.guolehui.com.cn" type="url">&nbsp;</a><a href="http://www.pma.com/" target="_blank"
                    type="url">
                    <img
                        src="http://mall.guolehui.com.cn/public/images/8d/31/80/c31024d70b9a7c236e97d0e5feeee4410435bc24.png?1493715025#w">&nbsp;&nbsp;</a>&nbsp;<a
                    href="http://www.guolehui.com.cn" type="url">
                    <img
                        src="http://mall.guolehui.com.cn/public/images/2f/bd/94/a38fbabff7dc8fcc85b540026472d06bc8527a6b.gif?1412564402#w"></a>&nbsp;<a
                    href="http://cnnic.cn/" target="_blank" type="url">&nbsp;
                    <img
                        src="http://mall.guolehui.com.cn/public/images/25/0d/e9/927e20eb9781d3460bdb396c2d395350c2f8f38c.jpg?1439453842#w"></a>&nbsp;&nbsp;
            </p>
            <div
                style="color:#333;font-family:Verdana;font-size:11px;line-height:20px!important;overflow:visible!important;display:block!important;visibility:visible!important;position:relative;z-Index:65535!important;text-align:center;">
                Powered By <a style="text-decoration:none" href="http://www.shopex.cn" target="_blank"><b
                        style="color: rgb(92, 113, 158);">Shop</b><b style="color: rgb(243, 144, 0);">Ex</b></a>
            </div>
        </div>

        <div class="wx_fix" id="footfd"></div>

    </div>
</body>
<script src="../libs/ajax.2.0.js"></script>
<script src="../libs/cookie.js"></script>
<script>
    class Car {
        constructor() {
            this.tbody = document.querySelector("tbody");
            this.url = "http://localhost:81/guolehui/data/goods.json";
            this.press = document.querySelector(".press")
            console.log(this.press)
            // D1.绑定span的点击事件
            this.addEvent();
            this.clear()
            // 请求所有数据
            this.init();
        }
        init() {
            var that = this;
            ajax({
                url: this.url,
                success: function (res) {
                    that.res = JSON.parse(res)
                    // console.log(that.res)
                    // 拿到cookie
                    that.getCookie()
                }
            })
        }
        getCookie() {
            // console.log(this.res)
            this.goods = JSON.parse(getCookie("shangpin"));
            // 渲染页面
            this.display();
        }
        display() {
            // console.log(this.res)
            // console.log(this.goods)
            var str = "";
            // 遍历所有数据
            for (var i = 0; i < this.res.length; i++) {
                // 遍历所有cookie
                for (var j = 0; j < this.goods.length; j++) {
                    // 两相对比，发现id重复，那就是要加入购物车的商品
                    if (this.res[i].goodsId == this.goods[j].id) {
                        str += `<tr index="${this.goods[j].id}">
                                        <td><input type="checkbox"></td>
                                        <td><img src="${this.res[i].src}"></td>
                                        <td>${this.res[i].name}</td>
                                        <td>${this.res[i].price}</td>
                                        <td><input type="number" value="${this.goods[j].num}" min=1></td>
                                        <td><span class="delete">删除</span></td>
                                    </tr>`
                    }
                }
            }
            this.tbody.innerHTML = str;
        }
        addEvent() {
            var that = this;
            // 利用事件委托绑定span的事件
            this.tbody.addEventListener("click", function (eve) {
                if (eve.target.className == "delete") {
                    // D2.保存商品id
                    that.id = eve.target.parentNode.parentNode.getAttribute("index");
                    // D3.删除DOM元素
                    eve.target.parentNode.parentNode.remove()
                    // D4.删除cookie中的数据
                    that.changeCookie(function (i) {
                        that.goods.splice(i, 1)
                    })
                }
            })
            this.tbody.addEventListener("input", function (eve) {
                if (eve.target.type == "number") {
                    // U1.保存商品id
                    that.id = eve.target.parentNode.parentNode.getAttribute("index");
                    // 保存输入框的值
                    // that.num = eve.target.value;
                    // U2.修改cookie中的数据
                    that.changeCookie(function (i) {
                        that.goods[i].num = eve.target.value;
                    })
                }
            })
        }
        changeCookie(callback) {
            for (var i = 0; i < this.goods.length; i++) {
                if (this.goods[i].id == this.id) {

                    // 删除或修改
                    callback(i)
                    break;
                }
            }
            // console.log(this.id)
            setCookie("shangpin", JSON.stringify(this.goods))
        }
        // removeCookie(){
        //     // 遍历cookie，找到符合点击的商品的数据
        //     for(var i=0;i<this.goods.length;i++){
        //         if(this.goods[i].id == this.id){
        //             // 从数组中将符合条件的数据，剔除出去
        //             this.goods.splice(i,1);
        //             break;
        //         }
        //     }
        //     // D5.把剔除了数据之后的数组，再塞回去
        //     setCookie("shangpin",JSON.stringify(this.goods))
        // }
        // setCookie(){
        //     // 遍历cookie，找到符合点击的商品的数据
        //     for(var i=0;i<this.goods.length;i++){
        //         if(this.goods[i].id == this.id){
        //             // 从数组中将符合条件的数据，修改
        //             this.goods[i].num = this.num;
        //             break;
        //         }
        //     }
        //     // U3.把剔除了数据之后的数组，再塞回去
        //     setCookie("shangpin",JSON.stringify(this.goods))
        // }
        clear() {
            console.log(111)
            var that = this;
            this.press.onclick = function () {
                removeCookie('shangpin');
                that.goods = [];
                that.display()
            }
        }
    }

    new Car();
</script>

</html>